/*!
 * GS SHOP - WCS ( Web Collecting System ) Script
 *
 * @author jake <__kim.jh4@gsshop.com__>
 * @copyright (c) 2017 GS SHOP
 * @link http://www.gsshop.com
 *
 */
var Wcs=Wcs||(function(){var global=this;String.prototype.startsWith=function(str){return this.indexOf(str)===0;};String.prototype.endsWith=function(str){var lastIndex=this.lastIndexOf(str);return(lastIndex!=-1)&&(lastIndex+str.length==this.length);};String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/gi,"");};String.prototype.toBoolean=function(){return(/^true$/i).test(this);};var _doc=document,_navi=navigator,_screen=screen,_win=window,_encodeWrapper=_win.encodeURIComponent,_decodeWrapper=_win.decodeURIComponent,_urldecode=unescape,_isIframe=(window.location!=window.parent.location),_topLevelDomain=[".com",".co.kr",".kr",".net",".org"];var _globalConfig={debug:"true".toBoolean(),denyDomains:[],serverHost:"wcs.gslook.com",cookie:{hash:false,sessionid:{key:"wa_sid",expires:30},referer:{use:false,key:"wa_ref",expires:30},pcid:{key:"wa_pcid",expires:60*24*365*10},userid:{key:"wa_userid",expires:60*24*365*10},randnum:{key:"wa_randnum",expires:60*24*365*10}},event:{keycode:[33,34,37,38,39,40]},uuidLen:21,ajax:{timeout:2000},onlyOnload:true,eventSendInterval:1000};var _siteConfig={nikeWeb:{cookie:{userid:function(){var tempcookienm="ecid";var cinfo=util.getCookie(tempcookienm);if(cinfo!=null&&cinfo!=""){var result=getParamValue(cinfo,"catvid","~");if(result=="0"){result="";}return result;}return"";},appmediatype:"appmediatype"},recommPrd:{params:{product:"prdid",plan:"planseq"},linkPattern:/(bnclick=)./},cartEvent:{functionName:"",argsIndex:3},loadTarget:[/\/prd\/prd\.gs/gi,/\/cart\/viewCart\.gs/gi,/\/order\/baskt\/baskt\.gs/gi,/\/jsp\/jseio_viewMyCart\.jsp/gi,/\/order\/main\/confirmOrder\.gs/gi,/\/order\/ordsht\/ordFsh\.gs/gi]},nikeMobile:{cookie:{userid:function(){var tempcookienm="ecid";var cinfo=util.getCookie(tempcookienm);if(cinfo!=null&&cinfo!=""){var result=getParamValue(cinfo,"catvid","~");if(result=="0"){result="";}return result;}return"";},appmediatype:"appmediatype"},recommPrd:{params:{product:"prdid",plan:"planseq"},linkPattern:/(bnclick=)./},cartEvent:{functionName:"",argsIndex:3},loadTarget:[/\/prd\/prd\.gs/gi,/\/cart\/viewCart\.gs/gi,/\/jsp\/jseio_viewMyCart\.jsp/gi,/\/order\/main\/confirmOrder\.gs/gi]}};var _data={pageInfo:{visitedTime:new Date().getTime()},buttonEventInfo:{btnNameList:[]}};function log(str){if(_win.console==undefined){console={log:function(){}};}if(_globalConfig.debug){}}function mixin(a,b){var re=a;for(p in b){if(a.hasOwnProperty(p)){if(isPlainObject(a[p])){re[p]=mixin(a[p],b[p]);}else{re[p]=b[p];}}else{re[p]=b[p];}}return re;}function isPlainObject(obj){return(obj!=null&&obj.constructor===Object);}function isDefined(property){return"undefined"!==typeof property;}function isFunction(property){return typeof property==="function";}function isObject(property){return typeof property==="object";}function isString(property){return typeof property==="string"||property instanceof String;}function isIE(){return _navi.userAgent.toLowerCase().indexOf("msie")>-1;}function isFF(){return _navi.userAgent.toLowerCase().indexOf("firefox")>-1;}function addEvent(element,eventType,eventHandler){if(element.addEventListener){element.addEventListener(eventType,eventHandler,false);}else{if(element.attachEvent){element.attachEvent("on"+eventType,eventHandler);}}}function getParamValue(url,paramName,delim){var result="";if(url!=null&&url!=""){if(url.indexOf("?")!=-1){url=url.split("?")[1];}delim=delim||"&";var urlSplit=url.split(delim);if(urlSplit!=null&&urlSplit.length>0){for(var i=0;i<urlSplit.length;i++){var params=urlSplit[i].split("=");if(params!=null&&params.length==2){if(params[0].trim()==paramName.trim()){result=params[1];break;}}}}}return result;}function ajax(url,callback){global.ajaxtimeout=false;log("sending ajax request : "+url);var httpRequest;if(window.XMLHttpRequest){httpRequest=new XMLHttpRequest();}else{if(window.ActiveXObject){try{httpRequest=new ActiveXObject("Msxml2.XMLHTTP");}catch(e){try{httpRequest=new ActiveXObject("Microsoft.XMLHTTP");}catch(e){}}}}if(!httpRequest){log("Cannot create an XMLHTTP instance");return false;}httpRequest.timeout=_globalConfig.ajax.timeout;httpRequest.onreadystatechange=responseHandler;httpRequest.open("GET",url);httpRequest.send(null);httpRequest.ontimeout=function(){global.ajaxtimeout=true;log("run ajax timeout : timeout ("+_globalConfig.ajax.timeout+" )");if(isFunction(callback)){callback();}};function responseHandler(){if(httpRequest.readyState===4&&!global.ajaxtimeout){if(isFunction(callback)){log("completed ajax response : "+url);callback();}}}}function getAllElementsWithAttribute(attr){var matchingElements=[];var allElements=document.getElementsByTagName("*");for(var i=0;i<allElements.length;i++){if(allElements[i].getAttribute(attr)){matchingElements.push(allElements[i]);}}return matchingElements;}var util={stringify:function(obj){var self=this;var t=typeof(obj);if(t!="object"||obj===null){if(t=="string"){obj='"'+obj+'"';}return String(obj);}else{var v,json=[],arr=(obj&&obj.constructor==Array);for(var n in obj){if(obj.hasOwnProperty(n)){v=obj[n];t=typeof(v);if(t=="string"){v='"'+v+'"';}else{if(t=="object"&&v!==null){v=self.stringify(v);}}json.push((arr?"":'"'+n+'":')+String(v));}}return(arr?"[":"{")+String(json)+(arr?"]":"}");}},contains:function(a,obj){for(var i=0;i<a.length;i++){if(a[i]===obj){return true;}}return false;},first:function(map){for(var p in map){if(map[p]){return p;break;}}return null;},match:function(s,re,i){if(!i){i=0;}var m=s.match(re);if(m&&m.length>i){return m[i];}return null;},getRandomNumber:function(min,max){return new Date().getTime()+""+(Math.floor(Math.random()*(max-min+1))+min);},getUUID:function(len,radix){var CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var chars=CHARS,uuid=[],i;radix=radix||chars.length;if(len){for(i=0;i<len;i++){uuid[i]=chars[0|Math.random()*radix];}}else{var r;uuid[8]=uuid[13]=uuid[18]=uuid[23]="-";uuid[14]="4";for(i=0;i<36;i++){if(!uuid[i]){r=0|Math.random()*16;uuid[i]=chars[(i==19)?(r&3)|8:r];}}}return uuid.join("");},createPvid:function(len,radix){var randomLimit=4;var randomInt=Math.floor(Math.random()*11)*3;var userAgentHash=this.sha1(_navi.userAgent);var docReferrerHash=this.sha1(_doc.referrer);var docLocationHash=this.sha1(_doc.location);var randomValue=this.getUUID(len,radix)+"-"+userAgentHash.substr(randomInt,randomLimit)+docReferrerHash.substr(randomInt,randomLimit)+docLocationHash.substr(randomInt,randomLimit)+"-"+new Date().getTime();return randomValue;},getCookie:function(key){var cookiePattern=new RegExp("(^|;)[ ]*"+key+"=([^;]*)"),cookieMatch=cookiePattern.exec(_doc.cookie);return cookieMatch?_decodeWrapper(cookieMatch[2]):0;},setCookie:function(key,value,opts){opts=opts||{};if(!value){opts.expires=-1;}else{if(typeof opts.expires=="number"){opts.expires=new Date(new Date().getTime()+(1000*60*opts.expires)).toUTCString();}}var defaultDomainCookie="";for(var i=0;i<_topLevelDomain.length;i++){var docDomain=_doc.domain;if(docDomain.indexOf(_topLevelDomain[i])!=-1){defaultDomainCookie=_topLevelDomain[i];var tempDomain=docDomain.replace(_topLevelDomain[i],"");var lastIdx=tempDomain.lastIndexOf(".");defaultDomainCookie=tempDomain.substring(lastIdx+1)+defaultDomainCookie;break;}}log("set cookie domain : "+defaultDomainCookie);var cookieExpires=opts.expires?opts.expires:"";var cookiePath=opts.path?opts.path:"/";var cookieDomain=opts.domain?opts.domain:defaultDomainCookie;var cookieSecure=opts.secure?"secure":"";_doc.cookie=key+"="+_encodeWrapper(String(value))+("; expires="+cookieExpires)+("; path="+cookiePath)+("; domain="+cookieDomain)+("; "+cookieSecure);},deleteCookie:function(key){setCookie(key,null);},utf8_encode:function(argString){return _urldecode(_encodeWrapper(argString));},sha1:function(str){var rotate_left=function(n,s){return(n<<s)|(n>>>(32-s));},cvt_hex=function(val){var str="",i,v;for(i=7;i>=0;i--){v=(val>>>(i*4))&15;str+=v.toString(16);}return str;},blockstart,i,j,W=[],H0=1732584193,H1=4023233417,H2=2562383102,H3=271733878,H4=3285377520,A,B,C,D,E,temp,str_len,word_array=[];str=this.utf8_encode(str);str_len=str.length;for(i=0;i<str_len-3;i+=4){j=str.charCodeAt(i)<<24|str.charCodeAt(i+1)<<16|str.charCodeAt(i+2)<<8|str.charCodeAt(i+3);word_array.push(j);}switch(str_len&3){case 0:i=2147483648;break;case 1:i=str.charCodeAt(str_len-1)<<24|8388608;break;case 2:i=str.charCodeAt(str_len-2)<<24|str.charCodeAt(str_len-1)<<16|32768;break;case 3:i=str.charCodeAt(str_len-3)<<24|str.charCodeAt(str_len-2)<<16|str.charCodeAt(str_len-1)<<8|128;break;}word_array.push(i);while((word_array.length&15)!==14){word_array.push(0);}word_array.push(str_len>>>29);word_array.push((str_len<<3)&4294967295);for(blockstart=0;blockstart<word_array.length;blockstart+=16){for(i=0;i<16;i++){W[i]=word_array[blockstart+i];}for(i=16;i<=79;i++){W[i]=rotate_left(W[i-3]^W[i-8]^W[i-14]^W[i-16],1);}A=H0;B=H1;C=H2;D=H3;E=H4;for(i=0;i<=19;i++){temp=(rotate_left(A,5)+((B&C)|(~B&D))+E+W[i]+1518500249)&4294967295;E=D;D=C;C=rotate_left(B,30);B=A;A=temp;}for(i=20;i<=39;i++){temp=(rotate_left(A,5)+(B^C^D)+E+W[i]+1859775393)&4294967295;E=D;D=C;C=rotate_left(B,30);B=A;A=temp;}for(i=40;i<=59;i++){temp=(rotate_left(A,5)+((B&C)|(B&D)|(C&D))+E+W[i]+2400959708)&4294967295;E=D;D=C;C=rotate_left(B,30);B=A;A=temp;}for(i=60;i<=79;i++){temp=(rotate_left(A,5)+(B^C^D)+E+W[i]+3395469782)&4294967295;E=D;D=C;C=rotate_left(B,30);B=A;A=temp;}H0=(H0+A)&4294967295;H1=(H1+B)&4294967295;H2=(H2+C)&4294967295;H3=(H3+D)&4294967295;H4=(H4+E)&4294967295;}temp=cvt_hex(H0)+cvt_hex(H1)+cvt_hex(H2)+cvt_hex(H3)+cvt_hex(H4);return temp.toLowerCase();},getWinHeight:function(){return(_win.innerHeight?_win.innerHeight:_doc.documentElement.clientHeight?_doc.documentElement.clientHeight:_doc.body.clientHeight);},getDocHeight:function(){return Math.max(Math.max(_doc.body.scrollHeight,_doc.documentElement.scrollHeight),Math.max(_doc.body.offsetHeight,_doc.documentElement.offsetHeight),Math.max(_doc.body.clientHeight,_doc.documentElement.clientHeight));},getDocScrollTop:function(doc){doc=doc||_doc;return Math.max(doc.documentElement.scrollTop,doc.body.scrollTop);},getScrollPos:function(){var pos={x:0,y:0};if(typeof _win.pageYOffset!="undefined"){pos.x=_win.pageXOffset;pos.y=_win.pageYOffset;}else{if(typeof _doc.documentElement.scrollTop!="undefined"&&_doc.documentElement.scrollTop>0){pos.x=_doc.documentElement.scrollLeft;pos.y=_doc.documentElement.scrollTop;}else{if(typeof _doc.body.scrollTop!="undefined"){pos.x=_doc.body.scrollLeft;pos.y=_doc.body.scrollTop;}}}return pos;},getBrowserEnv:function(agent){var a=(agent)?agent:_navi.userAgent||_navi.vendor||_win.opera;var env={};env.mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4));if(env.mobile){env.mobileBrand="";env.mobileDevice="";}env.browserGroup=util.first({ie:/MSIE/.test(a),firefox:/Firefox/.test(a),chrome:/Chrome/.test(a),safari:/Safari/.test(a),opera:/Opera/.test(a)})||"unknown";switch(env.browserGroup){case"ie":env.browser=util.match(a,/MSIE [0-9\.]+/);break;case"firefox":env.browser=util.match(a,/Firefox\/[0-9\.]+/);break;case"chrome":env.browser=util.match(a,/Chrome\/[0-9\.]+/);break;case"safari":env.browser=util.match(a,/Safari\/[0-9\.]+/);break;case"opera":env.browser=util.match(a,/Opera\/[0-9\.]+/);break;default:env.browser="";break;}env.language=_navi.userLanguage||_navi.language||"";env.operatingSystemGroup=util.first({ios:/like Mac OS X/.test(a),android:/Android/.test(a),windows:/Win/.test(a),macintosh:/Mac/.test(a),linux:/Linux/.test(a),unix:/X11/.test(a)})||"unknown";switch(env.operatingSystemGroup){case"android":env.operatingSystem=util.match(a,/Android [^;]+/);break;case"ios":env.operatingSystem=util.match(a,/(iP(ad|hone); CPU .+) like Mac/,1);break;case"windows":env.operatingSystem=util.match(a,/Windows [^;]+/);break;case"macintosh":env.operatingSystem=util.match(a,/Mac OS X [^;]+/);break;case"linux":env.operatingSystem=util.match(a,/X11; (Linux [^;]+)/,1);break;case"unix":env.operatingSystem="";break;default:break;}env.resolution=_screen.width+"x"+window.screen.height;env.app=/B[ST]$/.test(a);return env;}};return{setOrderInfo:function(orderNum,orderItemList,totalPay){_data.orderInfo=_data.orderInfo||{};_data.orderInfo={orderNum:orderNum,orderItemList:orderItemList,totalPay:totalPay};_data.pageInfo=_data.pageInfo||{};_data.pageInfo.pageType="ORDER";},setPrdInfo:function(){_data.pageInfo=_data.pageInfo||{};_data.pageInfo.pageType="PRD";},setCartInfo:function(obj){_data.cartInfo=_data.cartInfo||{};var cartItemList=[].concat(obj);var tempCartItemList=[];if(cartItemList&&cartItemList.length>0){for(var i=0;i<cartItemList.length;i++){var items=cartItemList[i].split(",");var tempObj={};if(items.length==3){tempObj={itemId:items[0],dealNo:items[1],addTime:items[2]};}else{tempObj={itemId:items[0],dealNo:"null",addTime:"null"};}tempCartItemList.push(tempObj);}}_data.cartInfo.cartItemList=tempCartItemList;_data.pageInfo=_data.pageInfo||{};_data.pageInfo.pageType="CART";},sendBtnEvtInfo:function(){_data.buttonEventInfo.btnNameList=_data.buttonEventInfo.btnNameList||[];if(_data.buttonEventInfo.autoFlushInterval){var evtCnt=_data.buttonEventInfo.btnNameList.length;if(evtCnt>0){log("button event send count : "+evtCnt);var sendUri="/"+_globalConfig.clientId+"/"+_globalConfig.siteId+"/btnevt";report({url:sendUri});_data.buttonEventInfo.btnNameList=[];global.sendedUrl[sendUri]=false;}}},sendEvt:function(eventCode,eventValue){var sendUri="/"+_globalConfig.clientId+"/"+_globalConfig.siteId+"/btnevt";report({url:sendUri,data:{eventCode:eventCode,eventValue:eventValue}});global.sendedUrl[sendUri]=false;},setBtnEvtInfo:function(btnname){},execute:function(conf){try{var config=conf||{};var clientId=config.clientId;var siteId=config.siteId;log("is iframe page : "+(_isIframe));if(clientId!=""&&siteId!=""&&!_isIframe){var wcsRandomNum=util.getCookie(_globalConfig.cookie.randnum.key);log("exists random number : "+wcsRandomNum);if(!wcsRandomNum){wcsRandomNum=util.getRandomNumber(10000000,99999999);log("new random number : "+wcsRandomNum);util.setCookie(_globalConfig.cookie.randnum.key,wcsRandomNum,{expires:_globalConfig.cookie.randnum.expires});}var wcsTrackers=config.trackers;var trackerSize=config.trackers.length||0;global.pageViewId="pvid-"+util.createPvid(_globalConfig.uuidLen);for(var tempIdx=0;tempIdx<trackerSize;tempIdx++){var trackerObj=wcsTrackers[tempIdx];var trackerName=trackerObj.name;var trackerIncludes=trackerObj.includes;var isProcess=(function(){var tempResult=true;if(trackerIncludes&&trackerIncludes.length>0){tempResult=false;var currentPath=_win.location.pathname;for(var includeIdx in trackerIncludes){var includePath=trackerIncludes[includeIdx];var removeStarPath=includePath.replace(/\*/gi,"");if(includePath.startsWith("*")&&includePath.endsWith("*")){if(currentPath.indexOf(removeStarPath)!=-1){tempResult=true;}}else{if(includePath.startsWith("*")){if(currentPath.endsWith(removeStarPath)){tempResult=true;}}else{if(includePath.endsWith("*")){if(currentPath.startsWith(removeStarPath)){tempResult=true;}}else{if(currentPath==currentPath){tempResult=true;}}}}}}return tempResult;})();if(isProcess){try{global.siteConfig=eval("_siteConfig."+siteId);var trackerClass=new (eval(trackerName+"Tracker"))(clientId,siteId,trackerIncludes);trackerClass.execute();}catch(e){log(e.message);}}}}}catch(e){log(e.message);}}};function report(args){if(!args&&args==null){return;}if(args.data&&args.data!=null){args.data=mixin(args.data,_data);}else{args.data=_data;}global.sendedUrl=global.sendedUrl||[];var tempSendedUrl=global.sendedUrl[args.url];if(tempSendedUrl){log("Skip the url because it is already sent : "+args.url);return;}var docDomain=_doc.domain;if(_globalConfig.denyDomains&&_globalConfig.denyDomains.length>0){for(var i=0;i<_globalConfig.denyDomains.length;i++){if(docDomain.indexOf(_globalConfig.denyDomains[i])!=-1){log(_globalConfig.denyDomains[i]+" is denied!");return;}}}try{var procImage=new Image(1,1);var convertData=util.stringify(args.data);convertData=convertData.replace(/undefined/g,'""');var sendUrl="https://"+_globalConfig.serverHost+(args.url)+"?data="+_encodeWrapper(convertData);if(args.isAjax){try{ajax(sendUrl,args.callback);}catch(ex){log("ajax call error : "+ex);if(isFunction(args.callback)){args.callback();}}}else{procImage.src=sendUrl;}log("sended data to : "+args.url);}catch(e){log("send error : "+e);}finally{global.sendedUrl[args.url]=true;}}function WebanalyticsTracker(clientId,siteId,includes){var data={pageViewId:global.pageViewId,pageInfo:{currentUrl:_win.location.href,charset:_doc.charset||_doc.characterSet},userInfo:{revisit:true},environment:{}};data=mixin(data,_data);var conf={name:"WebanalyticsTracker",url:"/"+clientId+"/"+siteId+"/load",procEvent:"load"};_globalConfig.clientId=clientId;_globalConfig.siteId=siteId;_globalConfig.includes=includes;mixin(conf,_globalConfig);return{execute:function(){if(_globalConfig.cookie.referer.use){data.pageInfo.referrerUrl=util.getCookie(_globalConfig.cookie.referer.key)||_doc.referrer||"";util.setCookie(_globalConfig.cookie.referer.key,data.pageInfo.currentUrl,{expires:_globalConfig.cookie.referer.expires});}else{data.pageInfo.referrerUrl=_doc.referrer||"";}data.environment=util.getBrowserEnv();var pcid;var pcid=util.getCookie(_globalConfig.cookie.pcid.key);if(!pcid){pcid=util.getUUID(_globalConfig.uuidLen);util.setCookie(_globalConfig.cookie.pcid.key,pcid,{expires:_globalConfig.cookie.pcid.expires});data.userInfo.revisit=false;}data.userInfo.pcId=pcid;try{data.userInfo.userId=global.siteConfig.cookie.userid();}catch(e){log("get userid error : "+e);}log("get userid : "+data.userInfo.userId);if(data.userInfo.userId==""){data.userInfo.userId=util.getCookie(global.siteConfig.cookie.userid);}if(data.userInfo.userId!=""&&data.userInfo.userId!="0"){util.setCookie(_globalConfig.cookie.userid.key,data.userInfo.userId,{expires:_globalConfig.cookie.userid.expires});}else{data.userInfo.userId=util.getCookie(_globalConfig.cookie.userid.key);if(data.userInfo.userId&&data.userInfo.userId=="0"){data.userInfo.userId="";util.setCookie(_globalConfig.cookie.userid.key,data.userInfo.userId,{expires:_globalConfig.cookie.userid.expires});}}data.userInfo.visitorId=(data.userInfo.userId&&data.userInfo.userId!=""&&data.userInfo.userId!="0")?data.userInfo.userId:data.userInfo.pcId;data.userInfo.gender=util.getCookie("gd");data.userInfo.age=util.getCookie("yd");var sid=util.getCookie(_globalConfig.cookie.sessionid.key);if(!sid){sid=data.pageInfo.visitedTime+"-"+data.userInfo.pcId;}util.setCookie(_globalConfig.cookie.sessionid.key,sid,{expires:_globalConfig.cookie.sessionid.expires});data.sessionId=sid;data.appmediatype=util.getCookie(global.siteConfig.cookie.appmediatype)||"";data.mediatype="";data.catvid="";var waCatvid=util.getCookie("wa_catvid")||"";var ecid=util.getCookie("ecid")||"";if(ecid&&ecid!=""){var ecidValArray=ecid.split("~");function getEcidValue(attrName){var resultVal="";for(var i=0,j=ecidValArray.length;i<j;i++){var tempValue=ecidValArray[i];if(tempValue.indexOf(attrName)!=-1){var tempSplits=tempValue.split("=");if(tempSplits&&tempSplits.length==2){resultVal=tempSplits[1];}break;}}return resultVal;}if(ecidValArray){data.mediatype=getEcidValue("mediatype");data.catvid=getEcidValue("catvid");if(data.catvid!=waCatvid){util.setCookie("wa_catvid",data.catvid,{expires:60*24*365*10});}}}else{data.catvid=waCatvid;}_data=mixin(_data,data);var sendOnload=_globalConfig.onlyOnload;if(!sendOnload){var loadTargetArray=global.siteConfig.loadTarget;var isloadEvent=false;if(loadTargetArray!=null&&loadTargetArray.length>0){for(var i=0;i<loadTargetArray.length;i++){if(loadTargetArray[i].test(data.pageInfo.currentUrl)){isloadEvent=true;break;}}}sendOnload=isloadEvent;}if(sendOnload){log("send data using onload");addEvent(_win,conf.procEvent,function(){report({url:conf.url});});}else{log("send data using execute");report({url:conf.url});}var tempEvent=isFF()?"unload":"beforeunload";addEvent(_win,tempEvent,function(){log("send onload data on unload event : "+conf.url);report({url:conf.url});});}};}function RecommendTracker(clientId,siteId,includes){var data={pageViewId:global.pageViewId,pageInfo:{visitedTime:new Date().getTime()},pageInfoExt:{},exposedRecommPrdList:[]};var conf={name:"RecommendTracker",url:"/"+clientId+"/"+siteId+"/leave",procEvent:(isFF()?"unload":"beforeunload"),scrollLatency:200};_globalConfig.clientId=clientId;_globalConfig.siteId=siteId;_globalConfig.includes=includes;mixin(conf,_globalConfig);return{execute:function(){global.scrollCount=0;global.scrollRange=0;global.pageDirection="down";global.prevY=0;function parseScrollCount(){if(global.countTimer){clearTimeout(global.countTimer);}global.countTimer=setTimeout(function(){var pos=util.getScrollPos();var currentY=pos.y;if(global.prevY<currentY&&global.pageDirection=="down"){global.pageDirection="up";global.scrollCount++;}else{if(global.prevY>currentY&&global.pageDirection=="up"){global.pageDirection="down";global.scrollCount++;}}global.prevY=currentY;},conf.scrollLatency);}function parseScrollPercent(){if(global.rangeTimer){clearTimeout(global.rangeTimer);}global.rangeTimer=setTimeout(function(){var tempScrollRange=(100*(util.getWinHeight()+util.getDocScrollTop())/util.getDocHeight())|0;var pos=util.getScrollPos();if(global.scrollRange<tempScrollRange&&pos.y>0){global.scrollRange=tempScrollRange;}},conf.scrollLatency);}function bingEventToCartButton(){function isScriptAction(searchAction,functionName){if(searchAction.indexOf(functionName)!=-1){return true;}return false;}var docA=_doc.getElementsByTagName("a");var cartFunctionInfo=eval("addCartEventInfo."+conf.siteId);if(docA!=null&&docA.length>0){for(var i=0;i<docA.length;i++){var scriptAction=docA[i].href;var isTargetEL=isScriptAction(scriptAction,cartFunctionInfo.functionName);if(!isTargetEL){scriptAction=docA[i].attributes.getNamedItem("onclick").value;isTargetEL=isScriptAction(scriptAction,cartFunctionInfo.functionName);}if(isTargetEL){addEvent(docA[i],"click",function(e){e.preventDefault();});}}}}function parseRecommendPrd(){var docA=_doc.getElementsByTagName("a");if(docA!=null&&docA.length>0){var exposedPrds=[];var tempRecommPrdInfo=global.siteConfig.recommPrd;for(var i=0;i<docA.length;i++){var hrefLink=docA[i].href;if(tempRecommPrdInfo.linkPattern.test(hrefLink)){hrefLink=hrefLink.replace(/&amp;/,"&");var bnclickValue=getParamValue(hrefLink,"bnclick");var bnclickValueSplit=bnclickValue.split("-");var exposeInfo={rset:bnclickValueSplit[0],algo:bnclickValueSplit[1],prdid:"",planid:""};if(!exposeInfo.algo){exposeInfo.algo="";}var exposeKey=getParamValue(hrefLink,tempRecommPrdInfo.params.product);if(exposeKey!=null&&exposeKey!=""){exposeInfo.prdid=exposeKey;}else{exposeKey=getParamValue(hrefLink,tempRecommPrdInfo.params.plan);exposeInfo.planid=exposeKey;}var isDuple=false;for(var m=0;m<exposedPrds.length;m++){var tempExposeInfo=exposedPrds[m];if(tempExposeInfo.prdid==exposeKey||tempExposeInfo.planid==exposeKey){isDuple=true;break;}}if(!isDuple){exposedPrds[exposedPrds.length]=exposeInfo;}}}data.exposedRecommPrdList=exposedPrds;}}var mousewheelevt=(/Firefox/i.test(_navi.userAgent))?"DOMMouseScroll":"mousewheel";addEvent(_doc,mousewheelevt,function(e){parseScrollCount();parseScrollPercent();});addEvent(_doc,"keydown",function(evt){var eventReference=(typeof evt!=="undefined")?evt:event;if(util.contains(_globalConfig.event.keycode,eventReference.keyCode)){parseScrollCount();parseScrollPercent();}});addEvent(_doc,"scroll",function(e){parseScrollCount();parseScrollPercent();});addEvent(_win,"load",function(e){try{parseRecommendPrd();}catch(ex){}});addEvent(_win,conf.procEvent,function(){if(_data.buttonEventInfo.autoFlushInterval){clearInterval(_data.buttonEventInfo.autoFlushInterval);}Wcs.sendBtnEvtInfo();data.pageInfoExt.durationTime=new Date().getTime()-data.pageInfo.visitedTime;data.pageInfoExt.scrollUpDownCount=global.scrollCount;data.pageInfoExt.scrollRange=global.scrollRange;report({url:conf.url,data:data});});}};}})();